<!--%-- 
    Document   : data
    Created on : Oct 19, 2013, 12:32:48 PM
    Author     : Raul Tobo
--%>

<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@ include file="buttons.jsp" % -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Perspectives Online</title>
        <link href="Styles.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="jscolor/jscolor.js"></script>

        <script src="datalist.js"></script>
        <script src="jQuery/jquery-1.10.2.js"></script>


        <script type="text/javascript" src="ajax.js"></script>
        <script type="text/javascript" src="property-manager.js"></script>

        <script>
            window.onload = function() {
                //make request for the dataFactories
                makeRequest('dataFactories');
                makeRequest('dataSourceIndex');

                var xmlhttp;
                var inpollprops = false;

                var cnt = 0;
                setInterval(pollprops, 500);



                function pollprops()
                {
                    //TO-DO:REMEMBER TO MAKE THE inpollprops false after handling the properties
                    if (inpollprops)
                        return;
                    inpollprops = true;

                    // cnt++;
                    xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function()
                    {
                        if (xmlhttp.readyState === 4 && xmlhttp.status === 200)
                        {


                            if (xmlhttp.responseText.length !== 0)
                            {
                                var dataProperties = document.getElementById("dataFactoryProperties");

                                document.getElementById("pollprops").value = "true";
                                addProperties(dataProperties, xmlhttp.responseText);

                            }
                            document.getElementById("pollprops").value = "false";
                            inpollprops = false;
                        }
                    };

                    var factoryItemName = document.getElementById("factoryItemName").value;

                    xmlhttp.open("GET", "VizOnlineServlet?page=pollprops&factoryItemName=" + factoryItemName + "&r=" + cnt, true);
                    xmlhttp.send();
                }


            };


            function dataTypeChanged() {
                var selectBox = document.getElementById("dataFactories");
                
                   if (selectBox.selectedIndex > 0) { //NB: index 0 has the "select one" option
                    makeRequest('dataSourceIndex');

                    //remove the children of the dataFactoryProperty div incase it had previous elements
                    var div = document.getElementById("dataFactoryProperties");
                    removeDivChildren(div);

                    //make the viewerName and create Data visible
                    document.getElementById("dataSourceStep2").style.display = "block";
                    //set the default-name for the viewerIndex
                    var dataType = document.getElementById("dataFactories").value;
                    var dataSourceIndex = document.getElementById("dataSourceIndex").value;
                    //NB: factory item-name and datasource name are the same
                    document.getElementById("dataSourceName").value = "Data" + dataSourceIndex + "-" + dataType;
                    document.getElementById("factoryItemName").value = "Data" + dataSourceIndex + "-" + dataType;
                    document.getElementById("dataFactoryType").value = dataType;
                    
                    selectBox.selectedIndex = 0; //reset the selected index to 0
                }

            }

            function dataFactoryProperties() {
                //hide the dataName and create data button 
                document.getElementById("dataSourceStep2").style.display = "none"
                document.getElementById("factoryItemName").value = document.getElementById("dataSourceName").value;
                //make request for the dataFactory properteis
                makeRequest('dataFactoryProperties');
            }



        </script>
    </head>

    <body>
        <div class="container">

            <a href="#"><img src="Images/VizOnline.png" alt="Logo" name="Logo" width="350" height="109" id="Insert_logo" float=left;" /></a>  

            <!-- end .header -->

            <div class="nav">                

                <a rel="tab" href="index.html" class="large button blue">HOME</a>
                <a rel="tab" href="data.html" class="large button blue">DATA SETS</a>
                <a rel="tab" href="viewers.html" class="large button blue">VIEWERS</a>
                <a rel="tab" href="links.html" class="large button blue">LINKS</a>
            </div>
            <!--end of button -->


            <div class="leftdiv">
                <h1>Create Dataset</h1>             

                <!-- <form action="javascript:makeRequest('upload')" enctype="multipart/form-data" method="post"> -->

                <select id="dataFactories" onchange="dataTypeChanged();">
                    <option value="selectOne">Select One</option>                

                </select>

                <div id="dataSourceStep2" style="display:none">
                    <p> Dataset Name
                        <input type="text" id="dataSourceName" />
                    </p>

                    <button type="button" class="small button blue"  onclick="dataFactoryProperties();">
                        Create Dataset
                    </button>

                </div>            

                <div id="dataFactoryProperties">

                </div>

                <input type="hidden" id="factoryType" value="DataSource" />
                <input type ="hidden" id="factoryItemName" value="" />
                <input type ="hidden" id="dataFactoryType" value="" />
                <input type ="hidden" id="pollprops" value="false" />
                <input type ="hidden" id="datasetprops" value="false" />
                <input type ="hidden" id="dataSourceIndex" value="" />

            </div>       



            <div class="rightdiv">
                <h1>Current Datasets</h1>
                <!--<input type ="button" class="small button blue" onclick="makeRequest('data')" name ="bt1" value="Display Data">-->
                <div id="cdatas"><script>makeRequest('getDataSourceNames');</script></div>
            </div>          

        </div>

    </body>
</html>

